# å…‰å¾© e äº’åŠ©å¹³å° - æŠ€è¡“æ¶æ§‹æ–‡ä»¶

**æ–‡ä»¶ç‰ˆæœ¬**: v1.0
**å»ºç«‹æ—¥æœŸ**: 2025-10-03_00:36:04
**æœ€å¾Œæ›´æ–°**: 2025-10-03_00:36:04

---

## ğŸ“‹ ç›®éŒ„

1. [ç³»çµ±æ¶æ§‹æ¦‚è¦½](#ç³»çµ±æ¶æ§‹æ¦‚è¦½)
2. [æŠ€è¡“æ£§](#æŠ€è¡“æ£§)
3. [å°ˆæ¡ˆçµæ§‹](#å°ˆæ¡ˆçµæ§‹)
4. [å‰ç«¯æ¶æ§‹](#å‰ç«¯æ¶æ§‹)
5. [å¾Œç«¯æ•´åˆ](#å¾Œç«¯æ•´åˆ)
6. [ç‹€æ…‹ç®¡ç†](#ç‹€æ…‹ç®¡ç†)
7. [èªè­‰èˆ‡æˆæ¬Š](#èªè­‰èˆ‡æˆæ¬Š)
8. [API è¨­è¨ˆ](#api-è¨­è¨ˆ)
9. [éƒ¨ç½²æ¶æ§‹](#éƒ¨ç½²æ¶æ§‹)

---

## ç³»çµ±æ¶æ§‹æ¦‚è¦½

### æ•´é«”æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ä½¿ç”¨è€…ä»‹é¢å±¤                       â”‚
â”‚         (Browser - Desktop / Mobile)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“ HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                å‰ç«¯æ‡‰ç”¨å±¤ (Next.js)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  App Router  â”‚  â”‚  React 19    â”‚  â”‚ TailwindCSSâ”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ NextAuth.js  â”‚  â”‚ React Query  â”‚  â”‚  Zustand  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“ REST API (JWT)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                å¾Œç«¯ API å±¤ (FastAPI)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  API Endpoints (OpenAPI Specification)       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  JWT Auth    â”‚  â”‚  æ¥­å‹™é‚è¼¯    â”‚  â”‚  è³‡æ–™å±¤   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 è³‡æ–™åº«å±¤ (PostgreSQL)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Users  â”‚  â”‚  Tasks  â”‚  â”‚  Orgs   â”‚  â”‚ Suppliesâ”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€è¡“æ¶æ§‹ç‰¹é»

- **å‰å¾Œç«¯åˆ†é›¢**: å‰ç«¯ Next.js + å¾Œç«¯ FastAPI
- **RESTful API**: æ¨™æº– HTTP æ–¹æ³•èˆ‡ç‹€æ…‹ç¢¼
- **JWT èªè­‰**: Stateless èº«ä»½é©—è­‰æ©Ÿåˆ¶
- **å‹åˆ¥å®‰å…¨**: TypeScript + OpenAPI Type Generation
- **éŸ¿æ‡‰å¼è¨­è¨ˆ**: TailwindCSS + shadcn/ui çµ„ä»¶åº«

---

## æŠ€è¡“æ£§

### å‰ç«¯æŠ€è¡“æ£§

| æŠ€è¡“ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Next.js** | 15.5.4 | React æ¡†æ¶ (App Router) |
| **React** | 19.1.0 | UI å‡½å¼åº« |
| **TypeScript** | 5.x | å‹åˆ¥ç³»çµ± |
| **TailwindCSS** | 4.x | CSS æ¡†æ¶ |
| **shadcn/ui** | latest | UI çµ„ä»¶åº« |
| **TanStack Query** | 5.90.2 | è³‡æ–™åŒæ­¥èˆ‡å¿«å– |
| **Zustand** | 5.0.8 | ç‹€æ…‹ç®¡ç† |
| **React Hook Form** | 7.63.0 | è¡¨å–®è™•ç† |
| **Zod** | 4.1.11 | Schema é©—è­‰ |
| **NextAuth.js** | 4.24.11 | èº«ä»½é©—è­‰ |
| **Lucide React** | 0.544.0 | Icon åº« |
| **openapi-fetch** | 0.14.1 | Type-safe API Client |

### å¾Œç«¯æŠ€è¡“æ£§

| æŠ€è¡“ | ç”¨é€” |
|------|------|
| **FastAPI** | Python Web æ¡†æ¶ |
| **PostgreSQL** | é—œè¯å¼è³‡æ–™åº« |
| **SQLAlchemy** | ORM |
| **Pydantic** | è³‡æ–™é©—è­‰ |
| **JWT** | Token èªè­‰ |
| **OpenAPI** | API æ–‡ä»¶è‡ªå‹•ç”Ÿæˆ |

### é–‹ç™¼å·¥å…·

- **Turbopack**: å¿«é€Ÿé–‹ç™¼å»ºç½®å·¥å…·
- **ESLint**: ç¨‹å¼ç¢¼æª¢æŸ¥
- **Prettier**: ç¨‹å¼ç¢¼æ ¼å¼åŒ–
- **openapi-typescript**: API å‹åˆ¥ç”Ÿæˆ

---

## å°ˆæ¡ˆçµæ§‹

### ç›®éŒ„çµæ§‹

```
e-cooperative/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                      # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ (auth)/              # èªè­‰ç›¸é—œè·¯ç”±ç¾¤çµ„
â”‚   â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ auth/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ [...nextauth]/
â”‚   â”‚   â”‚   â”‚           â”œâ”€â”€ options.ts    # NextAuth é…ç½®
â”‚   â”‚   â”‚   â”‚           â””â”€â”€ route.ts      # API Route Handler
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx       # èªè­‰é é¢ä½ˆå±€
â”‚   â”‚   â”‚   â””â”€â”€ login/
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx     # ç™»å…¥é é¢
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ dashboard/           # å„€è¡¨æ¿è·¯ç”±ç¾¤çµ„
â”‚   â”‚   â”‚   â”œâ”€â”€ [taskId]/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx     # ä»»å‹™è©³æƒ…é 
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx       # å„€è¡¨æ¿ä½ˆå±€
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx         # ä»»å‹™åˆ—è¡¨é 
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ layout.tsx           # æ ¹ä½ˆå±€
â”‚   â”‚   â””â”€â”€ not-found.tsx        # 404 é é¢
â”‚   â”‚
â”‚   â”œâ”€â”€ components/              # React çµ„ä»¶
â”‚   â”‚   â”œâ”€â”€ common/             # é€šç”¨çµ„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ header.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ providers.tsx
â”‚   â”‚   â”‚   â””â”€â”€ theme-provider.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ task/               # ä»»å‹™ç›¸é—œçµ„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ data.ts         # æ¨¡æ“¬è³‡æ–™
â”‚   â”‚   â”‚   â”œâ”€â”€ task-detail.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ tasks-table.tsx
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ui/                 # shadcn/ui çµ„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ table.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ login-form.tsx      # ç™»å…¥è¡¨å–®
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/                     # å·¥å…·å‡½å¼åº«
â”‚   â”‚   â”œâ”€â”€ api/                # API ç›¸é—œ
â”‚   â”‚   â”‚   â”œâ”€â”€ client.ts       # API Client è¨­å®š
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks.ts        # API Hooks
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”‚   â””â”€â”€ types.ts        # è‡ªå‹•ç”Ÿæˆçš„ API å‹åˆ¥
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ get-query-client.ts # React Query é…ç½®
â”‚   â”‚   â””â”€â”€ utils.ts            # é€šç”¨å·¥å…·å‡½å¼
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                   # TypeScript å‹åˆ¥å®šç¾©
â”‚   â”‚   â”œâ”€â”€ next-auth.d.ts      # NextAuth å‹åˆ¥æ“´å±•
â”‚   â”‚   â””â”€â”€ task.ts             # ä»»å‹™ç›¸é—œå‹åˆ¥
â”‚   â”‚
â”‚   â””â”€â”€ constant/               # å¸¸æ•¸å®šç¾©
â”‚       â”œâ”€â”€ common.ts
â”‚       â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ public/                      # éœæ…‹è³‡æº
â”‚
â”œâ”€â”€ doc/                         # æ–‡ä»¶ç›®éŒ„
â”‚   â”œâ”€â”€ pm/                     # PM æ–‡ä»¶
â”‚   â”œâ”€â”€ dev/                    # é–‹ç™¼æ–‡ä»¶
â”‚   â””â”€â”€ design/                 # è¨­è¨ˆæ–‡ä»¶
â”‚
â”œâ”€â”€ .env.local                   # ç’°å¢ƒè®Šæ•¸
â”œâ”€â”€ next.config.ts              # Next.js é…ç½®
â”œâ”€â”€ tailwind.config.ts          # TailwindCSS é…ç½®
â”œâ”€â”€ tsconfig.json               # TypeScript é…ç½®
â””â”€â”€ package.json                # å°ˆæ¡ˆä¾è³´
```

### è³‡æ–™å¤¾çµ„ç¹”åŸå‰‡

1. **æŒ‰åŠŸèƒ½åˆ†çµ„**: `app/` ç›®éŒ„ä½¿ç”¨è·¯ç”±ç¾¤çµ„ `(auth)`, `dashboard` ç­‰
2. **æŒ‰é¡å‹åˆ†çµ„**: `components/` åˆ†ç‚º `common/`, `task/`, `ui/`
3. **é›†ä¸­ç®¡ç†**: APIã€å‹åˆ¥ã€å¸¸æ•¸çµ±ä¸€æ”¾ç½®
4. **å¯ç¶­è­·æ€§**: æ¸…æ™°çš„è³‡æ–™å¤¾çµæ§‹ä¾¿æ–¼é•·æœŸç¶­è­·

---

## å‰ç«¯æ¶æ§‹

### App Router æ¶æ§‹

```
Next.js App Router (RSC)
â”œâ”€â”€ Root Layout (app/layout.tsx)
â”‚   â”œâ”€â”€ Providers
â”‚   â”‚   â”œâ”€â”€ QueryClientProvider (React Query)
â”‚   â”‚   â”œâ”€â”€ SessionProvider (NextAuth)
â”‚   â”‚   â””â”€â”€ ThemeProvider (next-themes)
â”‚   â”‚
â”‚   â”œâ”€â”€ (auth) Route Group
â”‚   â”‚   â”œâ”€â”€ Login Page (/login)
â”‚   â”‚   â””â”€â”€ Auth API Routes
â”‚   â”‚
â”‚   â””â”€â”€ Dashboard Route Group (/dashboard)
â”‚       â”œâ”€â”€ Task List (/)
â”‚       â”œâ”€â”€ Task Detail (/[taskId])
â”‚       â””â”€â”€ Protected by Middleware
```

### çµ„ä»¶æ¶æ§‹

#### 1. Server Components vs Client Components

**Server Components** (é è¨­):
- ä¸éœ€äº’å‹•çš„éœæ…‹å…§å®¹
- è³‡æ–™ç²å–
- SEO å„ªåŒ–

**Client Components** (ä½¿ç”¨ "use client"):
- éœ€è¦ hooks (useState, useEffect)
- éœ€è¦ç€è¦½å™¨ API
- äº‹ä»¶è™•ç†
- äº’å‹•å¼ UI

#### 2. çµ„ä»¶å±¤ç´š

```
é é¢çµ„ä»¶ (Page)
  â†“
ä½ˆå±€çµ„ä»¶ (Layout)
  â†“
æ¥­å‹™çµ„ä»¶ (Feature)
  â†“
é€šç”¨çµ„ä»¶ (Common)
  â†“
UI çµ„ä»¶ (shadcn/ui)
```

### æ¨£å¼ç³»çµ±

#### TailwindCSS + CVA

```typescript
// ä½¿ç”¨ class-variance-authority å»ºç«‹è®Šé«”
import { cva } from "class-variance-authority"

const buttonVariants = cva(
  "inline-flex items-center justify-center rounded-md",
  {
    variants: {
      variant: {
        default: "bg-primary text-white",
        outline: "border border-input",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 px-3",
        lg: "h-11 px-8",
      },
    },
  }
)
```

---

## å¾Œç«¯æ•´åˆ

### API Client è¨­å®š

#### 1. OpenAPI Type Generation

```bash
# å¾å¾Œç«¯ OpenAPI spec ç”Ÿæˆå‹åˆ¥
npm run api:types
```

åŸ·è¡Œå‘½ä»¤:
```bash
openapi-typescript http://hanservice.synology.me:8923/api/v1/openapi.json \
  -o src/lib/api/types.ts
```

#### 2. Type-safe API Client

```typescript
// src/lib/api/client.ts
import createClient, { type Client } from "openapi-fetch";
import type { paths } from "./types";

export const API_BASE_URL =
  process.env.NEXT_PUBLIC_API_BASE_URL ??
  "http://hanservice.synology.me:8923/api/v1";

export type ApiClient = Client<paths>;

export const createApiClient = (
  getAccessToken?: () => string | undefined,
  baseUrl: string = API_BASE_URL,
): ApiClient => {
  const client = createClient<paths>({ baseUrl });

  // èªè­‰ä¸­é–“ä»¶
  client.use({
    onRequest: ({ request }) => {
      const headers = new Headers(request.headers);
      headers.set("Content-Type", "application/json");
      const token = getAccessToken?.();
      if (token) headers.set("Authorization", `Bearer ${token}`);
      return new Request(request, { headers });
    },
  });

  return client;
};
```

#### 3. API Hooks

```typescript
// src/lib/api/hooks.ts
import { useQuery, useMutation } from "@tanstack/react-query";
import { apiClient } from "./client";

// æŸ¥è©¢ Hook ç¯„ä¾‹
export const useTaskList = () => {
  return useQuery({
    queryKey: ["tasks"],
    queryFn: async () => {
      const { data, error } = await apiClient.GET("/api/v1/tasks/");
      if (error) throw error;
      return data;
    },
  });
};

// è®Šæ›´ Hook ç¯„ä¾‹
export const useClaimTask = () => {
  return useMutation({
    mutationFn: async (taskId: string) => {
      const { data, error } = await apiClient.POST(
        "/api/v1/tasks/{task_id}/claim",
        { params: { path: { task_id: taskId } } }
      );
      if (error) throw error;
      return data;
    },
  });
};
```

### API ç«¯é»åˆ†é¡

#### èªè­‰ç›¸é—œ (`/api/v1/auth/*`)

| ç«¯é» | æ–¹æ³• | èªªæ˜ |
|------|------|------|
| `/auth/register` | POST | ä½¿ç”¨è€…è¨»å†Š |
| `/auth/login` | POST | ä½¿ç”¨è€…ç™»å…¥ |
| `/auth/me` | GET | å–å¾—ç•¶å‰ä½¿ç”¨è€…è³‡è¨Š |
| `/auth/me` | PUT | æ›´æ–°å€‹äººè³‡æ–™ |
| `/auth/change-password` | POST | ä¿®æ”¹å¯†ç¢¼ |

#### ä»»å‹™ç›¸é—œ (`/api/v1/tasks/*`)

| ç«¯é» | æ–¹æ³• | èªªæ˜ |
|------|------|------|
| `/tasks/` | GET | å–å¾—ä»»å‹™åˆ—è¡¨ |
| `/tasks/` | POST | å»ºç«‹æ–°ä»»å‹™ |
| `/tasks/{task_id}` | GET | å–å¾—ä»»å‹™è©³æƒ… |
| `/tasks/{task_id}` | PUT | æ›´æ–°ä»»å‹™ |
| `/tasks/{task_id}/claim` | POST | èªé ˜ä»»å‹™ |
| `/tasks/{task_id}/approve` | POST | å¯©æ ¸ä»»å‹™ |
| `/tasks/{task_id}/status` | PUT | æ›´æ–°ä»»å‹™ç‹€æ…‹ |

#### ä½¿ç”¨è€…ç®¡ç† (`/api/v1/users/*`)

| ç«¯é» | æ–¹æ³• | èªªæ˜ | æ¬Šé™ |
|------|------|------|------|
| `/users/` | GET | å–å¾—ä½¿ç”¨è€…åˆ—è¡¨ | Admin |
| `/users/{user_id}/role` | PUT | æ›´æ–°ä½¿ç”¨è€…è§’è‰² | Admin |
| `/users/{user_id}/approval` | PUT | å¯©æ ¸ä½¿ç”¨è€… | Admin |

#### çµ„ç¹”ç®¡ç† (`/api/v1/organization-approval/*`)

| ç«¯é» | æ–¹æ³• | èªªæ˜ |
|------|------|------|
| `/organization-approval/submit` | POST | æäº¤çµ„ç¹”ç”³è«‹ |
| `/organization-approval/pending` | GET | å–å¾—å¾…å¯©æ ¸çµ„ç¹” |
| `/organization-approval/{org_id}/approve` | POST | å¯©æ ¸çµ„ç¹” |

---

## ç‹€æ…‹ç®¡ç†

### React Query (TanStack Query)

ç”¨æ–¼**ä¼ºæœå™¨ç‹€æ…‹ç®¡ç†**:

- âœ… è³‡æ–™å¿«å–èˆ‡åŒæ­¥
- âœ… è‡ªå‹•èƒŒæ™¯é‡æ–°ç²å–
- âœ… æ¨‚è§€æ›´æ–°
- âœ… è«‹æ±‚å»é‡

```typescript
// è¨­å®š QueryClient
import { QueryClient } from "@tanstack/react-query";

export const getQueryClient = () => {
  return new QueryClient({
    defaultOptions: {
      queries: {
        staleTime: 60 * 1000, // 1 åˆ†é˜
        gcTime: 5 * 60 * 1000, // 5 åˆ†é˜
      },
    },
  });
};
```

### Zustand

ç”¨æ–¼**å®¢æˆ¶ç«¯ç‹€æ…‹ç®¡ç†**:

- âœ… UI ç‹€æ…‹ (modal é–‹é—œã€å´é‚Šæ¬„ç‹€æ…‹)
- âœ… è¡¨å–®è‰ç¨¿
- âœ… ä½¿ç”¨è€…åå¥½è¨­å®š

```typescript
// ç¯„ä¾‹: ä½¿ç”¨è€…è¨­å®š Store
import { create } from "zustand";
import { persist } from "zustand/middleware";

interface UserPreferenceStore {
  theme: "light" | "dark" | "system";
  setTheme: (theme: "light" | "dark" | "system") => void;
}

export const useUserPreference = create<UserPreferenceStore>()(
  persist(
    (set) => ({
      theme: "system",
      setTheme: (theme) => set({ theme }),
    }),
    {
      name: "user-preference",
    }
  )
);
```

---

## èªè­‰èˆ‡æˆæ¬Š

### NextAuth.js é…ç½®

```typescript
// src/app/(auth)/api/auth/[...nextauth]/options.ts
import { NextAuthOptions } from "next-auth";
import CredentialsProvider from "next-auth/providers/credentials";

export const authOptions: NextAuthOptions = {
  pages: {
    signIn: "/login",
  },
  providers: [
    CredentialsProvider({
      credentials: {
        email: { type: "email" },
        password: { type: "password" },
      },
      async authorize(credentials) {
        // å‘¼å«å¾Œç«¯ API é©—è­‰
        const res = await fetch(`${API_BASE_URL}/auth/login`, {
          method: "POST",
          body: JSON.stringify(credentials),
          headers: { "Content-Type": "application/json" },
        });

        const user = await res.json();

        if (res.ok && user) {
          return user; // { id, email, token, role }
        }
        return null;
      },
    }),
  ],
  callbacks: {
    async jwt({ token, user }) {
      if (user) {
        token.accessToken = user.token;
        token.role = user.role;
      }
      return token;
    },
    async session({ session, token }) {
      session.user.role = token.role;
      session.accessToken = token.accessToken;
      return session;
    },
  },
};
```

### å—ä¿è­·è·¯ç”±

```typescript
// middleware.ts (æ ¹ç›®éŒ„)
export { default } from "next-auth/middleware";

export const config = {
  matcher: ["/dashboard/:path*"],
};
```

### æ¬Šé™æª¢æŸ¥

```typescript
// å‰ç«¯æ¬Šé™æª¢æŸ¥
import { useSession } from "next-auth/react";

export const ProtectedButton = () => {
  const { data: session } = useSession();

  const canApprove = ["admin", "official_org"].includes(
    session?.user?.role
  );

  if (!canApprove) return null;

  return <button>å¯©æ ¸ä»»å‹™</button>;
};
```

---

## API è¨­è¨ˆ

### RESTful è¨­è¨ˆåŸå‰‡

1. **ä½¿ç”¨æ­£ç¢ºçš„ HTTP æ–¹æ³•**
   - `GET`: ç²å–è³‡æº
   - `POST`: å»ºç«‹è³‡æº
   - `PUT`: æ›´æ–°æ•´å€‹è³‡æº
   - `PATCH`: éƒ¨åˆ†æ›´æ–°è³‡æº
   - `DELETE`: åˆªé™¤è³‡æº

2. **ä½¿ç”¨æ­£ç¢ºçš„ç‹€æ…‹ç¢¼**
   - `200`: æˆåŠŸ
   - `201`: å»ºç«‹æˆåŠŸ
   - `400`: è«‹æ±‚éŒ¯èª¤
   - `401`: æœªèªè­‰
   - `403`: ç„¡æ¬Šé™
   - `404`: æ‰¾ä¸åˆ°è³‡æº
   - `500`: ä¼ºæœå™¨éŒ¯èª¤

3. **è³‡æºå‘½å**
   - ä½¿ç”¨è¤‡æ•¸åè©: `/tasks`, `/users`
   - éšå±¤å¼è³‡æº: `/tasks/{task_id}/volunteers`

### éŒ¯èª¤è™•ç†

```typescript
// çµ±ä¸€éŒ¯èª¤è™•ç†
export const handleApiError = (error: unknown) => {
  if (error instanceof Response) {
    switch (error.status) {
      case 401:
        // é‡æ–°å°å‘ç™»å…¥
        window.location.href = "/login";
        break;
      case 403:
        toast.error("æ‚¨æ²’æœ‰æ¬Šé™åŸ·è¡Œæ­¤æ“ä½œ");
        break;
      case 404:
        toast.error("æ‰¾ä¸åˆ°è³‡æº");
        break;
      default:
        toast.error("ç™¼ç”ŸéŒ¯èª¤,è«‹ç¨å¾Œå†è©¦");
    }
  }
};
```

---

## éƒ¨ç½²æ¶æ§‹

### ç’°å¢ƒè®Šæ•¸

```bash
# .env.local
NEXT_PUBLIC_API_BASE_URL=http://hanservice.synology.me:8923/api/v1
NEXTAUTH_SECRET=your-secret-key
NEXTAUTH_URL=http://localhost:3000
```

### å»ºç½®æµç¨‹

```bash
# é–‹ç™¼ç’°å¢ƒ
npm run dev

# ç”Ÿç”¢å»ºç½®
npm run build
npm start
```

### éƒ¨ç½²å»ºè­°

#### Vercel (æ¨è–¦)
- âœ… è‡ªå‹• CI/CD
- âœ… Edge Functions
- âœ… å…¨çƒ CDN
- âœ… è‡ªå‹• HTTPS

#### å…¶ä»–é¸é …
- Docker + Nginx
- AWS / GCP / Azure
- Cloudflare Pages

---

## é–‹ç™¼æœ€ä½³å¯¦è¸

### 1. å‹åˆ¥å®‰å…¨

```typescript
// âœ… ä½¿ç”¨è‡ªå‹•ç”Ÿæˆçš„å‹åˆ¥
import { components } from "@/lib/api/types";

type Task = components["schemas"]["Task"];

// âŒ é¿å…ä½¿ç”¨ any
const task: any = {...}; // ä¸å¥½

// âœ… ä½¿ç”¨æ˜ç¢ºå‹åˆ¥
const task: Task = {...}; // å¥½
```

### 2. ç¨‹å¼ç¢¼çµ„ç¹”

```typescript
// âœ… å–®ä¸€è·è²¬åŸå‰‡
// æ¯å€‹çµ„ä»¶åªåšä¸€ä»¶äº‹

// âœ… DRY åŸå‰‡
// é‡è¤‡çš„é‚è¼¯æŠ½å–æˆ Hook æˆ–å·¥å…·å‡½å¼

// âœ… ä½¿ç”¨ barrel exports
// index.ts çµ±ä¸€åŒ¯å‡º
```

### 3. æ•ˆèƒ½å„ªåŒ–

```typescript
// âœ… ä½¿ç”¨ React.memo é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
export const TaskCard = React.memo(({ task }) => {
  // ...
});

// âœ… ä½¿ç”¨ useMemo å¿«å–è¨ˆç®—çµæœ
const sortedTasks = useMemo(() => {
  return tasks.sort((a, b) => b.priority - a.priority);
}, [tasks]);

// âœ… ä½¿ç”¨ useCallback å¿«å–å‡½å¼
const handleClick = useCallback(() => {
  // ...
}, [deps]);
```

### 4. éŒ¯èª¤é‚Šç•Œ

```typescript
// ä½¿ç”¨ Error Boundary æ•æ‰éŒ¯èª¤
export class ErrorBoundary extends React.Component {
  componentDidCatch(error, errorInfo) {
    // è¨˜éŒ„éŒ¯èª¤åˆ°ç›£æ§æœå‹™
    console.error(error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return <ErrorFallback />;
    }
    return this.props.children;
  }
}
```

---

**æ–‡ä»¶çµæŸ**
